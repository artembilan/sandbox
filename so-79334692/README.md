# Concurrent SFTP Streaming Channel Adapters

The sample related to StackOverflow question: https://stackoverflow.com/questions/79334692/how-to-properly-ingest-files-from-a-sftp-server-with-spring-integration-sftp-whe.

It demonstrates two `Sftp.inboundStreamingAdapter()` instances consuming files from the same remote directory in parallel.
Thanks to `SftpPersistentAcceptOnceFileListFilter` based on the `JdbcMetadataStore` no one file is consumed twice.
The removal of the remote files in the end of the processing flow, confirms that no `SFTP error (SSH_FX_NO_SUCH_FILE): The file does not exist.` is emitted.

We can see in logs that really both of channel adapters are involved:
```
2025-01-22T17:12:33.824-05:00  INFO 33868 --- [so-79334692] [   scheduling-5] o.s.integration.handler.LoggingHandler   : From 'sftpInboundFlow2': GenericMessage [payload=SftpInputStreamAsync[ClientSessionImpl[test@localhost/127.0.0.1:52108]][/70.txt], headers={file_remoteHostPort=localhost:52108, file_remoteFileInfo={"directory":false,"filename":"70.txt","link":false,"modified":1737583949000,"permissions":"rw-rw-rw-","remoteDirectory":"/","size":2}, file_remoteDirectory=/, id=29113619-e436-e01c-8735-5b44f6a05dfc, closeableResource=org.springframework.integration.file.remote.session.CachingSessionFactory$CachedSession@6fc91f91, file_remoteFile=70.txt, timestamp=1737583953824}]
2025-01-22T17:12:33.839-05:00  INFO 33868 --- [so-79334692] [   scheduling-5] o.s.integration.handler.LoggingHandler   : From 'sftpInboundFlow2': GenericMessage [payload=SftpInputStreamAsync[ClientSessionImpl[test@localhost/127.0.0.1:52108]][/71.txt], headers={file_remoteHostPort=localhost:52108, file_remoteFileInfo={"directory":false,"filename":"71.txt","link":false,"modified":1737583949000,"permissions":"rw-rw-rw-","remoteDirectory":"/","size":2}, file_remoteDirectory=/, id=22b59f58-8a25-da0d-0c9d-0f24e7327443, closeableResource=org.springframework.integration.file.remote.session.CachingSessionFactory$CachedSession@ba17d6e, file_remoteFile=71.txt, timestamp=1737583953839}]
2025-01-22T17:12:33.839-05:00  INFO 33868 --- [so-79334692] [   scheduling-2] o.s.integration.handler.LoggingHandler   : From 'sftpInboundFlow1': GenericMessage [payload=SftpInputStreamAsync[ClientSessionImpl[test@localhost/127.0.0.1:52108]][/72.txt], headers={file_remoteHostPort=localhost:52108, file_remoteFileInfo={"directory":false,"filename":"72.txt","link":false,"modified":1737583949000,"permissions":"rw-rw-rw-","remoteDirectory":"/","size":2}, file_remoteDirectory=/, id=386e426d-913a-4b1b-fe29-bdb5afc42a60, closeableResource=org.springframework.integration.file.remote.session.CachingSessionFactory$CachedSession@5efd93c6, file_remoteFile=72.txt, timestamp=1737583953839}]
2025-01-22T17:12:33.855-05:00  INFO 33868 --- [so-79334692] [   scheduling-2] o.s.integration.handler.LoggingHandler   : From 'sftpInboundFlow1': GenericMessage [payload=SftpInputStreamAsync[ClientSessionImpl[test@localhost/127.0.0.1:52108]][/73.txt], headers={file_remoteHostPort=localhost:52108, file_remoteFileInfo={"directory":false,"filename":"73.txt","link":false,"modified":1737583949000,"permissions":"rw-rw-rw-","remoteDirectory":"/","size":2}, file_remoteDirectory=/, id=7b92fde5-2dbf-370b-8245-2b1710e7e562, closeableResource=org.springframework.integration.file.remote.session.CachingSessionFactory$CachedSession@7a4d0978, file_remoteFile=73.txt, timestamp=1737583953855}]
```

The `So79334692ApplicationTests` creates one hundred files on SFTP and verify that all those files have been processed without duplicates.